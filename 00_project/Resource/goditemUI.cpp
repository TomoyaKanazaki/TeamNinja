//============================================================
//
//	神器UI処理 [goditemUI.cpp]
//	Author：小原立暉
//
//============================================================
//************************************************************
//	インクルードファイル
//************************************************************
#include "goditemUI.h"

#include "anim2D.h"

//************************************************************
//	定数宣言
//************************************************************
namespace
{
	const int PRIORITY = 0;	// タイマーの優先順位

	namespace ui
	{
		const D3DXVECTOR3 POS[CGodItem::TYPE_MAX] =		// 位置
		{
			D3DXVECTOR3(640.0f, 30.0f, 0.0f),	// 赤
			D3DXVECTOR3(615.0f, 70.0f, 0.0f),	// 緑
			D3DXVECTOR3(665.0f, 70.0f, 0.0f)	// 青
		};
		const D3DXVECTOR3 ROT[CGodItem::TYPE_MAX] =		// 向き
		{
			D3DXVECTOR3(0.0f, 0.0f, (D3DX_PI * 2.0f) * 0.3f),	// 赤
			D3DXVECTOR3(0.0f, 0.0f, (D3DX_PI * 2.0f) * 0.6f),	// 緑
			D3DXVECTOR3(0.0f, 0.0f, (D3DX_PI * 2.0f) * 0.9f)	// 青
		};
		const D3DXVECTOR3 GROUND_SIZE = D3DXVECTOR3(50.0f, 50.0f, 0.0f);	// 下地のサイズ
		const D3DXVECTOR3 BODY_SIZE = D3DXVECTOR3(100.0f, 100.0f, 0.0f);		// 本体のサイズ
		const char* TEXTURE = "data\\TEXTURE\\itemGod000.png";		// テクスチャ
	}
}

//************************************************************
//	静的メンバ変数宣言
//************************************************************
CListManager<CGodItemUI>* CGodItemUI::m_pList = nullptr;	// オブジェクトリスト

//************************************************************
//	子クラス [CGodItemUI] のメンバ関数
//************************************************************
//============================================================
//	コンストラクタ
//============================================================
CGodItemUI::CGodItemUI() : CObject(CObject::LABEL_GODITEMUI, CObject::SCENE_MAIN, CObject::DIM_2D, PRIORITY)
{
	// メンバ変数をクリア
	memset(&m_apGround[0], 0, sizeof(m_apGround));	// 下地の情報
	memset(&m_aBody[0], 0, sizeof(m_aBody));		// 本体の情報
}

//============================================================
//	デストラクタ
//============================================================
CGodItemUI::~CGodItemUI()
{

}

//============================================================
//	初期化処理
//============================================================
HRESULT CGodItemUI::Init(void)
{
	// メンバ変数を初期化
	for (int nCntGround = 0; nCntGround < CGodItem::TYPE_MAX; nCntGround++)
	{
		// 下地が NULL の場合、次に進む
		if (m_apGround[nCntGround] != nullptr) { assert(false); continue; }

		// 下地を生成する
		m_apGround[nCntGround] = CAnim2D::Create
		(
			CGodItem::TYPE_MAX,		// テクスチャの横の分割数
			1,						// テクスチャの縦の分割数
			ui::POS[nCntGround],	// 位置
			ui::GROUND_SIZE,		// サイズ
			ui::ROT[nCntGround],	// 向き
			XCOL_BLACK				// 色
		);

		// テクスチャを割り当てる
		m_apGround[nCntGround]->BindTexture(ui::TEXTURE);

		// 優先順位を設定
		m_apGround[nCntGround]->SetPriority(PRIORITY);

		// カウンターを設定する
		m_apGround[nCntGround]->SetCounter(0);

		// パターンを設定する
		m_apGround[nCntGround]->SetPattern(nCntGround);

		// 停止状況を設定
		m_apGround[nCntGround]->SetEnableStop(false);
	}

	// メンバ変数を初期化
	for (int nCntBody = 0; nCntBody < CGodItem::TYPE_MAX; nCntBody++)
	{
		// 本体が NULL の場合、次に進む
		if (m_aBody[nCntBody].pMark != nullptr) { assert(false); continue; }

		// 本体を生成する
		m_aBody[nCntBody].pMark = CAnim2D::Create
		(
			CGodItem::TYPE_MAX,	// テクスチャの横の分割数
			1,					// テクスチャの縦の分割数
			ui::POS[nCntBody],	// 色
			ui::BODY_SIZE,		// サイズ
			ui::ROT[nCntBody],	// 向き
			XCOL_AWHITE			// 色
		);

		// テクスチャを割り当てる
		m_aBody[nCntBody].pMark->BindTexture(ui::TEXTURE);

		// 優先順位を設定
		m_aBody[nCntBody].pMark->SetPriority(PRIORITY);

		// カウンターを設定する
		m_aBody[nCntBody].pMark->SetCounter(0);

		// パターンを設定する
		m_aBody[nCntBody].pMark->SetPattern(nCntBody);

		// 停止状況を設定
		m_aBody[nCntBody].pMark->SetEnableStop(false);
	}

	if (m_pList == nullptr)
	{ // リストマネージャーが存在しない場合

		// リストマネージャーの生成
		m_pList = CListManager<CGodItemUI>::Create();
		if (m_pList == nullptr)
		{ // 生成に失敗した場合

			// 失敗を返す
			assert(false);
			return E_FAIL;
		}
	}

	// リストに自身のオブジェクトを追加・イテレーターを取得
	m_iterator = m_pList->AddList(this);

	// 成功を返す
	return S_OK;
}

//============================================================
//	終了処理
//============================================================
void CGodItemUI::Uninit(void)
{
	for (int nCnt = 0; nCnt < CGodItem::TYPE_MAX; nCnt++)
	{
		// 下地と本体を破棄する
		SAFE_UNINIT(m_apGround[nCnt]);
		SAFE_UNINIT(m_aBody[nCnt].pMark);
	}

	// リストから自身のオブジェクトを削除
	m_pList->DelList(m_iterator);

	if (m_pList->GetNumAll() == 0)
	{ // オブジェクトが一つもない場合

		// リストマネージャーの破棄
		m_pList->Release(m_pList);
	}

	// オブジェクトを破棄
	Release();
}

//============================================================
//	更新処理
//============================================================
void CGodItemUI::Update(const float fDeltaTime)
{
	for (int nCnt = 0; nCnt < CGodItem::TYPE_MAX; nCnt++)
	{
		if (m_apGround[nCnt] != nullptr)
		{ // 下地が NULL じゃない場合

			// 更新処理
			m_apGround[nCnt]->Update(fDeltaTime);
		}

		if (m_aBody[nCnt].pMark != nullptr)
		{ // 本体が NULL じゃない場合

			// 更新処理
			m_aBody[nCnt].pMark->Update(fDeltaTime);
		}
	}
}

//============================================================
//	描画処理
//============================================================
void CGodItemUI::Draw(CShader* /*pShader*/)
{
	for (int nCntGround = 0; nCntGround < CGodItem::TYPE_MAX; nCntGround++)
	{
		// 下地が NULL じゃない場合、次に進む
		if (m_apGround[nCntGround] == nullptr) { continue; }

		// 描画処理
		m_apGround[nCntGround]->Draw();
	}

	for (int nCntBody = 0; nCntBody < CGodItem::TYPE_MAX; nCntBody++)
	{
		// 本体が NULL じゃない場合、次に進む
		if (m_aBody[nCntBody].pMark == nullptr) { continue; }

		// 描画処理
		m_aBody[nCntBody].pMark->Draw();
	}
}

//============================================================
// 取得処理
//============================================================
void CGodItemUI::Get(const CGodItem::EType type)
{
	// 取得していた場合、停止
	if (m_aBody[type].bGet) { assert(false); return; }

	// 取得状況を true にする
	m_aBody[type].bGet = true;

	// 出現させる
	m_aBody[type].pMark->SetAlpha(1.0f);
}

//============================================================
//	生成処理
//============================================================
CGodItemUI* CGodItemUI::Create(void)
{
	// タイマーの生成
	CGodItemUI* pTimer = new CGodItemUI;
	if (pTimer == nullptr)
	{ // 生成に失敗した場合

		return nullptr;
	}
	else
	{ // 生成に成功した場合

		// タイマーの初期化
		if (FAILED(pTimer->Init()))
		{ // 初期化に失敗した場合

			// タイマーの破棄
			SAFE_DELETE(pTimer);
			return nullptr;
		}

		// 確保したアドレスを返す
		return pTimer;
	}
}

//============================================================
//	リスト取得処理
//============================================================
CListManager<CGodItemUI>* CGodItemUI::GetList(void)
{
	// オブジェクトリストを返す
	return m_pList;
}
